<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tag player ğŸš€</title>
    <script src="/js/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }

        .main-container {
            display: flex;
            flex: 1;
            width: 100%;
            height: calc(100vh - 20%);
            /* ç•™å‡ºåº•éƒ¨æŒ‰é’®çš„ç©ºé—´ */
        }

        /* æµ‹è¯•ä¿¡æ¯æ  */
        #infoContainer {
            flex: 0.8;
            overflow-y: auto;
            background-color: #ffffff;
            border-left: 1px solid #ccc;
            padding: 10px;
        }

        /* è§†é¢‘æ  */
        #videoContainer {
            flex: 3;
            /* å¢åŠ è§†é¢‘å®¹å™¨çš„å æ¯” */
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f0f0f0;
            padding: 10px;
        }

        .video-wrapper {
            width: 100%;
            /* å¢åŠ è§†é¢‘å®½åº¦ */
            max-width: 100%;
            /* é™åˆ¶æœ€å¤§å®½åº¦ */
            height: auto;
            /* ä¿æŒè§†é¢‘æ¯”ä¾‹ */
        }

        /* æ ‡ç­¾æ˜¾ç¤ºæ  */
        #listContainer {
            flex: 1.2;
            overflow-y: auto;
            background-color: #ffffff;
            border-left: 1px solid #ccc;
            padding: 10px;
        }

        #listContainer ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            /* è®¾ç½®ä¸ºä¸¤åˆ— */
            gap: 4px;
            /* å‡å°åˆ—é—´è· */
        }

        #listContainer li {
            padding: 2px;
            font-size: 10px;
            text-align: left;
            /* å·¦å¯¹é½æ–‡æœ¬ */
            background-color: #ffffff;
            /* å»æ‰èƒŒæ™¯è‰² */
            cursor: pointer;
        }

        #listContainer li:hover {
            background-color: #f0f0f0;
            /* é¼ æ ‡æ‚¬åœæ—¶çš„é«˜äº®æ•ˆæœ */
        }
        
        /* æŒ‰é’® */
        #buttonContainer {
            display: flex;
            justify-content: center;
            gap: 8px;
            position: fixed;
            /* å›ºå®šä½ç½® */
            bottom: 0;
            /* é”å®šåˆ°é¡µé¢åº•éƒ¨ */
            left: 0;
            height: 30px;
            max-height: 10%;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            /* åŠé€æ˜èƒŒæ™¯ */
            padding: 8px 0;
            /* æ·»åŠ ä¸€äº›å†…è¾¹è· */
            z-index: 1000;
            /* ç¡®ä¿åœ¨æœ€ä¸Šå±‚ */
        }

        .controlbutton {
            width: 60px;
            height: 30px;
            max-height: 100%;
            font-size: 20px;
            margin: 2px;
            cursor: pointer;
            border: 2px solid black;
            border-radius: 5px;
            background-color: white;
            display: flex;
            align-items: center;    /* å‚ç›´å±…ä¸­ */
            justify-content: center; /* æ°´å¹³å±…ä¸­ */
        }

        .controlbutton:hover {
            background-color: #0056b3;
        }

        .timeline {
            margin-top: 20px;
            padding: 10px;
            border-top: 1px solid #ccc;
            width: 80%;
            overflow-y: auto;
            height: calc(100vh);
            margin-bottom: 4%;
            /* ä¸ºæŒ‰é’®å®¹å™¨ç•™å‡ºç©ºé—´ */
        }

        .timeline-item {
            display: flex;
            align-items: center;
            height: 16px;
            margin-bottom: 10px;
            gap: 10px;
        }

        .timeline-item input[type="text"] {
            margin-right: 5px;
            padding: 2px;
            width: 80px;
            font-size: 12px;
        }
         
        .timeline-item  span{
            padding: 5px;
            font-size: 12px;
            margin-right: 5px;
            width: 30px;
        }

        .timeline-item select {
            width: 100px;
            height: 20px;
        }
    </style>
</head>

<body>

    <div class="main-container">
        <!-- æµ‹è¯•ä¿¡æ¯ -->
        <div id="infoContainer">
            <label for="cityInput">åŸå¸‚:</label>
            <input type="text" id="cityInput" placeholder="è¯·è¾“å…¥åŸå¸‚">
            <br>
            <label for="carModelInput">è½¦å‹:</label>
            <input type="text" id="carModelInput" placeholder="è¯·è¾“å…¥è½¦å‹">
            <br>
            <label for="dateInput">æ—¥æœŸ:</label>
            <input type="date" id="dateInput">
            <br>
            <label for="timePeriodInput">æ—¶æ®µ:</label>
            <input type="text" id="timePeriodInput" placeholder="è¯·è¾“å…¥æ—¶æ®µ">
            <br>
            <label for="routeInput">çº¿è·¯:</label>
            <input type="text" id="routeInput" placeholder="è¯·è¾“å…¥çº¿è·¯">
        </div>
        <!-- è§†é¢‘å®¹å™¨ -->
        <div id="videoContainer">
            <div class="video-wrapper">
                <video id="videoPlayer" controls style="width: 100%;"></video>
            </div>
        </div>
        <!-- åˆ—è¡¨å®¹å™¨ -->
        <div id="listContainer">
            <ul id="scenarioList">
                <!-- åˆ—è¡¨é¡¹ -->
                <li>1 å·¦è½¬-æ— åšå¼ˆ</li>
                <li>2 å·¦è½¬-åŒå‘è½¦è¾†åšå¼ˆ</li>
                <li>3 å·¦è½¬-å¯¹å‘è½¬å¼¯è½¦è¾†åšå¼ˆ</li>
                <li>4 å·¦è½¬-VRUåšå¼ˆ</li>
                <li>5 å·¦è½¬-å¾…è¡ŒåŒº</li>
                <li>6 ç›´è¡Œ-æ— åšå¼ˆ</li>
                <li>7 ç›´è¡Œ-æœ‰åšå¼ˆ</li>
                <li>8 ç›´è¡Œ-å¾…è¡ŒåŒº</li>
                <li>9 å³è½¬-æ— åšå¼ˆ</li>
                <li>10 å³è½¬-åŒå‘è½¦è¾†åšå¼ˆ</li>
                <li>11 å³è½¬-å¯¹å‘è½¬å¼¯è½¦è¾†åšå¼ˆ</li>
                <li>12 å³è½¬-VRUåšå¼ˆ</li>
                <li>13 ç¯å²›-æœ‰ä¿¡å·ç¯</li>
                <li>14 ç¯å²›-æ— ä¿¡å·ç¯</li>
                <li>15 æ‰å¤´-æ— åšå¼ˆ</li>
                <li>16 æ‰å¤´-æœ‰åšå¼ˆ</li>
                <li>17 è½¦é“ä¿æŒä¸è·Ÿè½¦</li>
                <li>18 æ‹¥å µè·Ÿè½¦</li>
                <li>19 å¯¼èˆªå˜é“</li>
                <li>20 åˆ‡å…¥é¿è®©</li>
                <li>21 ç»•è¡Œå é“è½¦è¾†ä¸è¡Œäºº</li>
                <li>22 çª„è·¯-ç»•è¡ŒåŒå‘è½¦è¾†ä¸VRU</li>
                <li>23 è¶…è¶Šæ…¢è½¦</li>
                <li>24 å¯¹å‘ä¼šè½¦</li>
                <li>25 çª„è·¯-å¯¹å‘è½¦è¾†ä¸VRUåšå¼ˆ</li>
                <li>26 çª„è·¯-æ‰å¤´</li>
                <li>27 å‡ºä¸»è·¯è¿›è¾…è·¯</li>
                <li>28 å‡ºè¾…è·¯è¿›ä¸»è·¯</li>
                <li>29 åŸå¿«åŒé“å†…åˆ†æµ</li>
                <li>30 åŸå¿«åŒé“å†…åˆæµ</li>
                <li>31 ä¸ŠåŒé“æ±‡å…¥åŸå¿«</li>
                <li>32 å‡ºåŸå¿«ä¸‹åŒé“</li>
                <li>33 æ–½å·¥åŒºåŸŸé€šè¡Œ</li>
                <li>34 å·¦è½¬-å¯¹å‘ç›´è¡Œè½¦è¾†åšå¼ˆ</li>
                <li>35 å­¦æ ¡åŒºåŸŸé€šè¡Œ</li>
                <li>36 éš§é“é€šè¡Œ</li>
                <li>37 æ”¶è´¹ç«™é€šè¡Œ</li>
                <li>38 äº¤è­¦-æœ‰æŒ‡æŒ¥</li>
                <li>39 äº¤è­¦-æ— æŒ‡æŒ¥</li>
                <li>40 è¿åäº¤è§„</li>
                <li>41 é©¾é©¶å‘˜ç´§æ€¥å¹²é¢„åŠæ¥ç®¡</li>
                <li>42 é©¾é©¶å‘˜ä¸»åŠ¨å¹²é¢„</li>
                <li>43 ç³»ç»Ÿè¯·æ±‚æ¥ç®¡</li>
                <li>44 æ— æ•ˆæ•°æ®</li>
                <li>45 é¿è®©æ¨ªç©¿VRU</li>
                <li>46 å¤æ‚ç‹­çª„å··é“é€šè¡Œ</li>
            </ul>
        </div>
    </div>

    <input type="file" id="videoInput" accept="video/*" style="display: none;">

    <div class="timeline" id="timeline">
        <div id="timelineItems"></div>
        <div id="buttonContainer">
            <div id="currentTimeDisplay" style="text-align: center; font-size: 16px; margin-top: 6px; color: #333;">
                å½“å‰æ—¶é—´: 00:00:00
            </div>
            <button id="addTimelineItemButton" class="controlbutton">â•</button>
            <button id="importButton" class="controlbutton">ğŸ“¥</button>
            <button id="rewindButton2" class="controlbutton">5â®ï¸</button>
            <button id="rewindButton" class="controlbutton">âª</button>
            <button id="playButton" class="controlbutton">â–¶ï¸</button>
            <button id="fastForwardButton" class="controlbutton">â©</button>
            <button id="fastForwardButton2" class="controlbutton">â­ï¸5</button>
            <button id="exportButton" class="controlbutton">ğŸ“¤</button>
        </div>
    </div>
    <script>
        
        let currentPausedTime = 0;
        let timelineItemCounter = 0; // åˆå§‹åŒ–è®¡æ•°å™¨ï¼Œä» 0 å¼€å§‹

        // ç¡®ä¿æ­£ç¡®è·å–è§†é¢‘å’Œæ—¶é—´æ˜¾ç¤ºå…ƒç´ 
        // å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå®æ—¶æ›´æ–°æ—¶é—´
        function updateCurrentTime() {
        const video = document.querySelector('#videoContainer video');
        const currentTimeDisplay = document.getElementById('currentTimeDisplay');
        const currentTime = formatTime(video.currentTime); // æ ¼å¼åŒ–å½“å‰æ—¶é—´
        currentTimeDisplay.textContent = `å½“å‰æ—¶é—´: ${currentTime}`; // æ›´æ–°æ˜¾ç¤ºå†…å®¹
        console.log(`å½“å‰æ—¶é—´: ${currentTime}`); // æ§åˆ¶å°è¾“å‡ºå½“å‰æ—¶é—´
        const playButton =document.getElementById('playButton');
        if (video.paused) {
            playButton.textContent = 'â–¶ï¸';
        } else {
            playButton.textContent = 'â¸ï¸';
        }
        }

        // æ¯ç§’æ›´æ–°ä¸€æ¬¡æ—¶é—´
        setInterval(updateCurrentTime, 100);

        // æ ¼å¼åŒ–æ—¶é—´ä¸º MM:SS æ ¼å¼
        function formatTime(seconds) {
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = Math.floor(seconds % 60);
        return `${String(minutes).padStart(2, '0')}:${String(remainingSeconds).padStart(2, '0')}`;
        }

        // æ—¶é—´æ ¼å¼åŒ–å‡½æ•°
        function formatTime(seconds) {
        const h = Math.floor(seconds / 3600).toString().padStart(2, '0');
        const m = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
        const s = Math.floor(seconds % 60).toString().padStart(2, '0');
        return `${h}:${m}:${s}`;
        }

        // è§†é¢‘å¯¼å…¥
        document.getElementById('importButton').addEventListener('click', function () {
            document.getElementById('videoInput').click();
        });
        
        document.getElementById('videoInput').addEventListener('change', function (event) {
            const files = event.target.files;
            const videoContainer = document.getElementById('videoContainer');
            videoContainer.innerHTML = ''; // Clear existing videos

            if (files.length > 0) {
                const file = files[0];
                const videoWrapper = document.createElement('div');
                videoWrapper.className = 'video-wrapper';

                const video = document.createElement('video');
                video.controls = true;
                video.src = URL.createObjectURL(file);
                video.style.width = '100%';
                videoWrapper.appendChild(video);

                video.onpause = function () {
                    currentPausedTime = video.currentTime;
                };

                videoContainer.appendChild(videoWrapper);
            }
        });

        let isStartTimeSet = false;
        let lastStartTimeInput = null;

        document.getElementById('addTimelineItemButton').addEventListener('click', function () {
            const timelineItems = document.getElementById('timelineItems');
            const video = document.querySelector('#videoContainer video');
            const currentTime = formatTime(video.currentTime); // æ ¼å¼åŒ–å½“å‰æ—¶é—´

            if (!isStartTimeSet) {
                const timelineItem = document.createElement('div');
                timelineItem.className = 'timeline-item';

                // æ·»åŠ é¡ºåºç¼–å·
                const itemNumber = document.createElement('span');
                itemNumber.textContent = `${timelineItemCounter}. `;
                itemNumber.style.marginRight = '10px';
                timelineItem.appendChild(itemNumber);

                const startTimeInput = document.createElement('input');
                startTimeInput.type = 'text';
                startTimeInput.className = 'input';
                startTimeInput.value = currentTime;
                startTimeInput.placeholder = 'å¼€å§‹æ—¶é—´';

                const endTimeInput = document.createElement('input');
                endTimeInput.type = 'text';
                endTimeInput.className = 'input';
                endTimeInput.placeholder = 'ç»“æŸæ—¶é—´';

                const sceneTagInput = document.createElement('input');
                sceneTagInput.type = 'text';
                sceneTagInput.className = 'input';
                sceneTagInput.placeholder = 'åœºæ™¯æ ‡ç­¾';
                sceneTagInput.id = 'sceneTag';

                const difficultyLabel = document.createElement('span');
                difficultyLabel.textContent = 'éš¾åº¦: ';
                difficultyLabel.className = 'label';
                const difficultyTagInput = document.createElement('select');
                difficultyTagInput.className = 'select';

                // // æ·»åŠ ä¸€ä¸ªç©ºé€‰é¡¹ä½œä¸ºå ä½ï¼ˆæœªé€‰ä¸­çŠ¶æ€ï¼‰
                // const placeholderOption = document.createElement('option');
                // placeholderOption.value = ''; // ç©ºå€¼
                // placeholderOption.textContent = '';
                // placeholderOption.disabled = true; // ç¦æ­¢é€‰ä¸­
                // placeholderOption.selected = true; // é»˜è®¤é€‰ä¸­ï¼ˆä½†ä¸å¯æ“ä½œï¼‰
                // difficultyTagInput.appendChild(placeholderOption);

                // ä¿®æ”¹éš¾åº¦é€‰é¡¹æ˜¾ç¤ºï¼šå°†1,2,3æ”¹ä¸ºéš¾,ä¸­,æ˜“
                const difficultyOptions = ['éš¾', 'ä¸­', 'æ˜“'];
                const difficultyValues = ['1', '2', '3'];
                difficultyOptions.forEach((optionText, index) => {
                    const option = document.createElement('option');
                    option.value = difficultyValues[index];
                    option.textContent = optionText;
                    // è®¾ç½®é»˜è®¤é€‰ä¸­"æ˜“"ï¼ˆå³ç´¢å¼•ä¸º2çš„é€‰é¡¹ï¼‰
                    if (optionText === 'æ˜“') {
                        option.selected = true;
                    }
                    difficultyTagInput.appendChild(option);
                });

                const remarkTagInput = document.createElement('input');
                remarkTagInput.type = 'text';
                remarkTagInput.placeholder = 'æè¿°';

                const anquanTagLabel = document.createElement('span');
                anquanTagLabel.textContent = 'å®‰å…¨: ';
                anquanTagLabel.className = 'label';
                const anquanTagInput = document.createElement('select');
                anquanTagInput.className = 'select';
                // ä¿®æ”¹å®‰å…¨é€‰é¡¹æ˜¾ç¤ºï¼šå°†1,2,3æ”¹ä¸ºå¥½,ä¸­,å·®
                const anquanOptions = ['', 'å¥½', 'ä¸­', 'å·®'];
                const anquanValues = ['', '1', '2', '3'];
                anquanOptions.forEach((optionText, index) => {
                    const option = document.createElement('option');
                    option.value = anquanValues[index];
                    option.textContent = optionText;
                    // è®¾ç½®é»˜è®¤é€‰ä¸­"å¥½"
                    if (optionText === 'å¥½') {
                        option.selected = true;
                    }
                    anquanTagInput.appendChild(option);
                });

                const xiaolvTagLabel = document.createElement('span');
                xiaolvTagLabel.textContent = 'æ•ˆç‡: ';
                xiaolvTagLabel.className = 'label';
                const xiaolvTagInput = document.createElement('select');
                xiaolvTagInput.className = 'select';
                // ä¿®æ”¹æ•ˆç‡é€‰é¡¹æ˜¾ç¤ºï¼šå°†1,2,3æ”¹ä¸ºå¥½,ä¸­,å·®
                const xiaolvOptions = ['', 'å¥½', 'ä¸­', 'å·®'];
                const xiaolvValues = ['', '1', '2', '3'];
                xiaolvOptions.forEach((optionText, index) => {
                    const option = document.createElement('option');
                    option.value = xiaolvValues[index];
                    option.textContent = optionText;
                    // è®¾ç½®é»˜è®¤é€‰ä¸­"å¥½"
                    if (optionText === 'å¥½') {
                        option.selected = true;
                    }
                    xiaolvTagInput.appendChild(option);
                });

                const shushiTagLabel = document.createElement('span');
                shushiTagLabel.textContent = 'èˆ’é€‚: ';
                shushiTagLabel.className = 'label';
                const shushiTagInput = document.createElement('select');
                shushiTagInput.className = 'select';
                // ä¿®æ”¹èˆ’é€‚é€‰é¡¹æ˜¾ç¤ºï¼šå°†1,2,3æ”¹ä¸ºå¥½,ä¸­,æŸ¥
                const shushiOptions = ['', 'å¥½', 'ä¸­', 'æŸ¥'];
                const shushiValues = ['', '1', '2', '3'];
                shushiOptions.forEach((optionText, index) => {
                    const option = document.createElement('option');
                    option.value = shushiValues[index];
                    option.textContent = optionText;
                    // è®¾ç½®é»˜è®¤é€‰ä¸­"å¥½"
                    if (optionText === 'å¥½') {
                        option.selected = true;
                    }
                    shushiTagInput.appendChild(option);
                });

                const nrhremarkTagInput = document.createElement('input');
                nrhremarkTagInput.type = 'text';
                nrhremarkTagInput.placeholder = 'æ‹ŸäººåŒ–æè¿°';

                // ä¿®æ”¹åˆ›å»ºå…ƒç´ çš„ä»£ç ï¼Œç»™æ¯ä¸ªè¾“å…¥æ¡†/ä¸‹æ‹‰æ¡†æ·»åŠ å”¯ä¸€æ ‡è¯†
                startTimeInput.setAttribute('data-role', 'start-time');
                endTimeInput.setAttribute('data-role', 'end-time');
                sceneTagInput.setAttribute('data-role', 'scene-tag');
                difficultyTagInput.setAttribute('data-role', 'difficulty');
                remarkTagInput.setAttribute('data-role', 'remark');
                anquanTagInput.setAttribute('data-role', 'anquan');
                xiaolvTagInput.setAttribute('data-role', 'xiaolv');
                shushiTagInput.setAttribute('data-role', 'shushi');
                nrhremarkTagInput.setAttribute('data-role', 'nrhremark');

                // å°†ç¼–å·å’Œè¾“å…¥æ¡†æ·»åŠ åˆ° timelineItem
                
                timelineItem.appendChild(startTimeInput);
                timelineItem.appendChild(endTimeInput);
                timelineItem.appendChild(sceneTagInput);
                timelineItem.appendChild(difficultyLabel);
                timelineItem.appendChild(difficultyTagInput);
                timelineItem.appendChild(remarkTagInput);
                timelineItem.appendChild(anquanTagLabel);
                timelineItem.appendChild(anquanTagInput);
                timelineItem.appendChild(xiaolvTagLabel);
                timelineItem.appendChild(xiaolvTagInput);
                timelineItem.appendChild(shushiTagLabel);
                timelineItem.appendChild(shushiTagInput);
                timelineItems.appendChild(timelineItem);
                timelineItem.appendChild(nrhremarkTagInput);

                // è‡ªåŠ¨æ»šåŠ¨åˆ°æ–°æ·»åŠ çš„å…ƒç´ 
                timelineItem.scrollIntoView({ behavior: 'smooth', block: 'end' });

                isStartTimeSet = true;
                lastStartTimeInput = endTimeInput;

                timelineItemCounter++; // å¢åŠ è®¡æ•°å™¨
            } else {
                lastStartTimeInput.value = currentTime;
                isStartTimeSet = false;
                lastStartTimeInput = null;
            }
        });

        // æ’­æ”¾/æš‚åœ
        document.getElementById('playButton').addEventListener('click', function () {
            const video = document.querySelector('#videoContainer video');
            if (video.paused) {
                video.play();
            }
            else {
                video.pause();
            }
        });
        // å¿«è¿›
        document.getElementById('fastForwardButton').addEventListener('click', function () {
            const video = document.querySelector('#videoContainer video');
            if (video) {
                video.currentTime += 1; // å¿«è¿›1ç§’
            }
        });
        document.getElementById('fastForwardButton2').addEventListener('click', function () {
            const video = document.querySelector('#videoContainer video');
            if (video) {
                video.currentTime += 5; // å¿«è¿›5ç§’
            }
        });
         // åé€€
        document.getElementById('rewindButton').addEventListener('click', function () {
            const video = document.querySelector('#videoContainer video');
            if (video) {
                video.currentTime -= 1; // åé€€1ç§’
            }
        });
        document.getElementById('rewindButton2').addEventListener('click', function () {
            const video = document.querySelector('#videoContainer video');
            if (video) {
                video.currentTime -= 5; // åé€€5ç§’
            }
        });

        // ä¿®æ”¹å¯¼å‡ºåŠŸèƒ½ï¼ŒåŠ¨æ€ç”Ÿæˆæ–‡ä»¶å
        document.getElementById('exportButton').addEventListener('click', function () {
            const timelineItems = document.querySelectorAll('.timeline-item');
            const timelineData = [];

            // æ”¶é›†æ•°æ®
            timelineItems.forEach((item, index) => {
                const startTime = item.querySelector('[data-role="start-time"]').value;
                const endTime = item.querySelector('[data-role="end-time"]').value;
                const sceneTag = item.querySelector('[data-role="scene-tag"]').value;
                // ä¿®æ”¹éš¾åº¦å€¼æ˜¾ç¤ºï¼šå°†1,2,3è½¬æ¢ä¸ºæ˜“,ä¸­,éš¾
                const difficultyElement = item.querySelector('[data-role="difficulty"]');
                let difficultyTag = difficultyElement.value;
                if (difficultyTag === '1') {
                    difficultyTag = 'éš¾';
                } else if (difficultyTag === '2') {
                    difficultyTag = 'ä¸­';
                } else if (difficultyTag === '3') {
                    difficultyTag = 'æ˜“';
                }
                const remarkTag = item.querySelector('[data-role="remark"]').value;
                const anquanTag = item.querySelector('[data-role="anquan"]').value;
                const xiaolvTag = item.querySelector('[data-role="xiaolv"]').value;
                const shushiTag = item.querySelector('[data-role="shushi"]').value;
                const nrhremarkTag = item.querySelector('[data-role="nrhremark"]').value;
                timelineData.push([
                    index, // ç¼–å·ä» 0 å¼€å§‹
                    startTime,
                    endTime,
                    sceneTag,
                    difficultyTag,
                    remarkTag,
                    anquanTag,
                    xiaolvTag,
                    shushiTag,
                    nrhremarkTag
                ]);
            });

            // æ·»åŠ è¡¨å¤´
            const header = ["ç¼–å·", "å¼€å§‹æ—¶é—´", "ç»“æŸæ—¶é—´", "åœºæ™¯æ ‡ç­¾", "åœºæ™¯éš¾åº¦", "æè¿°", "å®‰å…¨", "æ•ˆç‡", "èˆ’é€‚", "æ‹ŸäººåŒ–æè¿°"];
            timelineData.unshift(header);

            // åˆ›å»ºå·¥ä½œç°¿å’Œå·¥ä½œè¡¨
            const worksheet = XLSX.utils.aoa_to_sheet(timelineData);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "Timeline");

            // è·å–è¾“å…¥æ¡†çš„å€¼
            const city = document.getElementById('cityInput').value || "åŸå¸‚";
            const carModel = document.getElementById('carModelInput').value || "è½¦å‹";
            let date = document.getElementById('dateInput').value || "æ—¥æœŸ";
            const timePeriod = document.getElementById('timePeriodInput').value || "æ—¶æ®µ";
            const route = document.getElementById('routeInput').value || "çº¿è·¯";

            // å°†æ—¥æœŸæ ¼å¼åŒ–ä¸º YYYYMMDD
            if (date !== "æ—¥æœŸ") {
                date = date.replace(/-/g, ""); // å»æ‰æ—¥æœŸä¸­çš„ "-"
            }
            // åŠ¨æ€ç”Ÿæˆæ–‡ä»¶å
            const fileName = `${city}_${carModel}_${date}_${timePeriod}_${route}.xlsx`;

            // å¯¼å‡ºä¸ºæ–‡ä»¶
            XLSX.writeFile(workbook, fileName);
        });
    </script>
</body>

</html>