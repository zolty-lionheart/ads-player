<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tag player ğŸš€</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }

        .main-container {
            display: flex;
            flex: 1;
            width: 100%;
            height: calc(100vh - 20%);
            /* ç•™å‡ºåº•éƒ¨æŒ‰é’®çš„ç©ºé—´ */
        }

        /* æµ‹è¯•ä¿¡æ¯æ  */
        #infoContainer {
            flex: 0.8;
            overflow-y: auto;
            background-color: #ffffff;
            border-left: 1px solid #ccc;
            padding: 10px;
        }

        /* è§†é¢‘æ  */
        #videoContainer {
            flex: 3;
            /* å¢åŠ è§†é¢‘å®¹å™¨çš„å æ¯” */
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f0f0f0;
            padding: 10px;
        }

        .video-wrapper {
            width: 100%;
            /* å¢åŠ è§†é¢‘å®½åº¦ */
            max-width: 100%;
            /* é™åˆ¶æœ€å¤§å®½åº¦ */
            height: auto;
            /* ä¿æŒè§†é¢‘æ¯”ä¾‹ */
        }

        /* æ ‡ç­¾æ˜¾ç¤ºæ  */
        #listContainer {
            flex: 1.2;
            overflow-y: auto;
            background-color: #ffffff;
            border-left: 1px solid #ccc;
            padding: 10px;
        }

        #listContainer ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            /* è®¾ç½®ä¸ºä¸¤åˆ— */
            gap: 4px;
            /* å‡å°åˆ—é—´è· */
        }

        #listContainer li {
            padding: 2px;
            font-size: 14px;
            text-align: left;
            /* å·¦å¯¹é½æ–‡æœ¬ */
            background-color: #ffffff;
            /* å»æ‰èƒŒæ™¯è‰² */
            cursor: pointer;
        }

        #listContainer li:hover {
            background-color: #f0f0f0;
            /* é¼ æ ‡æ‚¬åœæ—¶çš„é«˜äº®æ•ˆæœ */
        }

        /* æŒ‰é’® */
        #buttonContainer {
            display: flex;
            justify-content: center;
            gap: 8px;
            position: fixed;
            /* å›ºå®šä½ç½® */
            bottom: 0;
            /* é”å®šåˆ°é¡µé¢åº•éƒ¨ */
            left: 0;
            height: 30px;
            max-height: 10%;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            /* åŠé€æ˜èƒŒæ™¯ */
            padding: 8px 0;
            /* æ·»åŠ ä¸€äº›å†…è¾¹è· */
            z-index: 1000;
            /* ç¡®ä¿åœ¨æœ€ä¸Šå±‚ */
        }

        .button {
            width: 60px;
            height: 30px;
            max-height: 100%;
            font-size: 20px;
            margin: 2px;
            cursor: pointer;
            border: 2px solid black;
            border-radius: 5px;
            background-color: white;
            display: flex;
            align-items: center;
            /* å‚ç›´å±…ä¸­ */
            justify-content: center;
            /* æ°´å¹³å±…ä¸­ */
        }

        .button:hover {
            background-color: #0056b3;
        }

        .timeline {
            margin-top: 20px;
            padding: 10px;
            border-top: 1px solid #ccc;
            width: 80%;
            overflow-y: auto;
            height: calc(100vh);
            margin-bottom: 4%;
            /* ä¸ºæŒ‰é’®å®¹å™¨ç•™å‡ºç©ºé—´ */
        }

        .timeline-item {
            display: flex;
            align-items: center;
            height: 16px;
            margin-bottom: 10px;
            gap: 10px;
        }

        .timeline-item input[type="text"] {
            margin-right: 5px;
            padding: 2px;
            width: 80px;
            font-size: 12px;
        }

        .timeline-item span {
            padding: 5px;
            font-size: 12px;
            margin-right: 5px;
            width: 30px;
        }

        .timeline-item select {
            width: 100px;
            height: 20px;
        }
    </style>
</head>

<body>

    <div class="main-container">
        <!-- æµ‹è¯•ä¿¡æ¯ -->
        <div id="infoContainer">
        </div>
        <!-- è§†é¢‘å®¹å™¨ -->
        <div id="videoContainer">
            <div class="video-wrapper">
                <video id="videoPlayer" controls style="width: 100%;"></video>
            </div>
        </div>
        <!-- åˆ—è¡¨å®¹å™¨ -->
        <div id="listContainer">
            <ul id="scenarioList">
                <!-- åˆ—è¡¨é¡¹ -->
                <li>1 å·¦è½¬-æ— åšå¼ˆ</li>
                <li>2 å·¦è½¬-åŒå‘è½¦è¾†åšå¼ˆ</li>
                <li>3 å·¦è½¬-å¯¹å‘è½¬å¼¯è½¦è¾†åšå¼ˆ</li>
                <li>4 å·¦è½¬-VRUåšå¼ˆ</li>
                <li>5 å·¦è½¬-å¾…è¡ŒåŒº</li>
                <li>6 ç›´è¡Œ-æ— åšå¼ˆ</li>
                <li>7 ç›´è¡Œ-æœ‰åšå¼ˆ</li>
                <li>8 ç›´è¡Œ-å¾…è¡ŒåŒº</li>
                <li>9 å³è½¬-æ— åšå¼ˆ</li>
                <li>10 å³è½¬-åŒå‘è½¦è¾†åšå¼ˆ</li>
                <li>11 å³è½¬-å¯¹å‘è½¬å¼¯è½¦è¾†åšå¼ˆ</li>
                <li>12 å³è½¬-VRUåšå¼ˆ</li>
                <li>13 ç¯å²›-æœ‰ä¿¡å·ç¯</li>
                <li>14 ç¯å²›-æ— ä¿¡å·ç¯</li>
                <li>15 æ‰å¤´-æ— åšå¼ˆ</li>
                <li>16 æ‰å¤´-æœ‰åšå¼ˆ</li>
                <li>17 è½¦é“ä¿æŒä¸è·Ÿè½¦</li>
                <li>18 æ‹¥å µè·Ÿè½¦</li>
                <li>19 å¯¼èˆªå˜é“</li>
                <li>20 åˆ‡å…¥é¿è®©</li>
                <li>21 ç»•è¡Œå é“è½¦è¾†ä¸è¡Œäºº</li>
                <li>22 çª„è·¯-ç»•è¡ŒåŒå‘è½¦è¾†ä¸VRU</li>
                <li>23 è¶…è¶Šæ…¢è½¦</li>
                <li>24 å¯¹å‘ä¼šè½¦</li>
                <li>25 çª„è·¯-å¯¹å‘è½¦è¾†ä¸VRUåšå¼ˆ</li>
                <li>26 çª„è·¯-æ‰å¤´</li>
                <li>27 å‡ºä¸»è·¯è¿›è¾…è·¯</li>
                <li>28 å‡ºè¾…è·¯è¿›ä¸»è·¯</li>
                <li>29 åŸå¿«åŒé“å†…åˆ†æµ</li>
                <li>30 åŸå¿«åŒé“å†…åˆæµ</li>
                <li>31 ä¸ŠåŒé“æ±‡å…¥åŸå¿«</li>
                <li>32 å‡ºåŸå¿«ä¸‹åŒé“</li>
                <li>33 æ–½å·¥åŒºåŸŸé€šè¡Œ</li>
                <li>34 å·¦è½¬-å¯¹å‘ç›´è¡Œè½¦è¾†åšå¼ˆ</li>
                <li>35 å­¦æ ¡åŒºåŸŸé€šè¡Œ</li>
                <li>36 éš§é“é€šè¡Œ</li>
                <li>37 æ”¶è´¹ç«™é€šè¡Œ</li>
                <li>38 äº¤è­¦-æœ‰æŒ‡æŒ¥</li>
                <li>39 äº¤è­¦-æ— æŒ‡æŒ¥</li>
                <li>40 è¿åäº¤è§„</li>
                <li>41 é©¾é©¶å‘˜ç´§æ€¥å¹²é¢„åŠæ¥ç®¡</li>
                <li>42 é©¾é©¶å‘˜ä¸»åŠ¨å¹²é¢„</li>
                <li>43 ç³»ç»Ÿè¯·æ±‚æ¥ç®¡</li>
                <li>44 æ— æ•ˆæ•°æ®</li>
                <li>45 é¿è®©æ¨ªç©¿VRU</li>
                <li>46 å¤æ‚ç‹­çª„å··é“é€šè¡Œ</li>
            </ul>
        </div>
    </div>

    <input type="file" id="videoInput" accept="video/*" style="display: none;">

    <div class="timeline" id="timeline">
        <div id="timelineItems"></div>
        <div id="buttonContainer">
            <div id="currentTimeDisplay" style="text-align: center; font-size: 16px; margin-top: 6px; color: #333;">
                å½“å‰æ—¶é—´: 00:00:00
            </div>
            <button id="addTimelineItemButton" class="button">â•</button>
            <button id="importButton" class="button">ğŸ“¥</button>
            <button id="rewindButton" class="button">âª</button>
            <button id="playAllButton" class="button">â–¶ï¸</button>
            <button id="pauseAllButton" class="button">â¸ï¸</button>
            <button id="fastForwardButton" class="button">â©</button>
            <button id="fastForward5Button" class="button">â©5</button>
            <button id="exportButton" class="button">ğŸ“¤</button>
        </div>
    </div>

    <script>
        let currentPausedTime = 0;
        let timelineItemCounter = 0; // åˆå§‹åŒ–è®¡æ•°å™¨ï¼Œä» 0 å¼€å§‹

        // ç¡®ä¿æ­£ç¡®è·å–è§†é¢‘å’Œæ—¶é—´æ˜¾ç¤ºå…ƒç´ 
        // å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå®æ—¶æ›´æ–°æ—¶é—´
        function updateCurrentTime() {
            const video = document.querySelector('#videoContainer video');
            const currentTimeDisplay = document.getElementById('currentTimeDisplay');
            const currentTime = formatTime(video.currentTime); // æ ¼å¼åŒ–å½“å‰æ—¶é—´
            currentTimeDisplay.textContent = `å½“å‰æ—¶é—´: ${currentTime}`; // æ›´æ–°æ˜¾ç¤ºå†…å®¹
            console.log(`å½“å‰æ—¶é—´: ${currentTime}`); // æ§åˆ¶å°è¾“å‡ºå½“å‰æ—¶é—´
        }

        // æ¯ç§’æ›´æ–°ä¸€æ¬¡æ—¶é—´
        setInterval(updateCurrentTime, 200);

        // æ—¶é—´æ ¼å¼åŒ–å‡½æ•°
        function formatTime(seconds) {
            const h = Math.floor(seconds / 3600).toString().padStart(2, '0');
            const m = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
            const s = Math.floor(seconds % 60).toString().padStart(2, '0');
            return `${h}:${m}:${s}`;
        }

        // è§†é¢‘å¯¼å…¥
        document.getElementById('importButton').addEventListener('click', function () {
            document.getElementById('videoInput').click();
        });

        document.getElementById('videoInput').addEventListener('change', function (event) {
            const files = event.target.files;
            const videoContainer = document.getElementById('videoContainer');
            videoContainer.innerHTML = ''; // Clear existing videos

            if (files.length > 0) {
                const file = files[0];
                const videoWrapper = document.createElement('div');
                videoWrapper.className = 'video-wrapper';

                const video = document.createElement('video');
                video.controls = true;
                video.src = URL.createObjectURL(file);
                video.style.width = '100%';
                videoWrapper.appendChild(video);

                video.onpause = function () {
                    currentPausedTime = video.currentTime;
                };

                videoContainer.appendChild(videoWrapper);
            }
        });

        document.getElementById('playAllButton').addEventListener('click', function () {
            const video = document.querySelector('#videoContainer video');
            if (video) {
                video.play();
            }
        });

        document.getElementById('pauseAllButton').addEventListener('click', function () {
            const video = document.querySelector('#videoContainer video');
            if (video) {
                video.pause();
            }
        });

        let isStartTimeSet = false;
        let lastStartTimeInput = null;

        document.getElementById('addTimelineItemButton').addEventListener('click', function () {
            const timelineItems = document.getElementById('timelineItems');

            if (!isStartTimeSet) {
                const timelineItem = document.createElement('div');
                timelineItem.className = 'timeline-item';

                // æ·»åŠ é¡ºåºç¼–å·
                const itemNumber = document.createElement('span');
                itemNumber.textContent = `${timelineItemCounter}. `;
                itemNumber.style.marginRight = '10px';
                timelineItem.appendChild(itemNumber);

                const startTimeInput = document.createElement('input');
                startTimeInput.type = 'text';
                startTimeInput.className = 'input';
                startTimeInput.value = formatTime(currentPausedTime);
                startTimeInput.placeholder = 'å¼€å§‹æ—¶é—´';

                const endTimeInput = document.createElement('input');
                endTimeInput.type = 'text';
                endTimeInput.className = 'input';
                endTimeInput.placeholder = 'ç»“æŸæ—¶é—´';

                const sceneTagInput = document.createElement('input');
                sceneTagInput.type = 'text';
                sceneTagInput.className = 'input';
                sceneTagInput.placeholder = 'åœºæ™¯æ ‡ç­¾';
                sceneTagInput.id = 'sceneTag';

                const difficultyLabel = document.createElement('span');
                difficultyLabel.textContent = 'éš¾åº¦: ';
                difficultyLabel.className = 'label';
                const difficultyTagInput = document.createElement('select');
                difficultyTagInput.className = 'select';

                const difficultyOptions = ['3', '2', '1'];
                difficultyOptions.forEach(optionValue => {
                    const option = document.createElement('option');
                    option.value = optionValue;
                    option.textContent = optionValue;
                    difficultyTagInput.appendChild(option);
                });

                const anquanTagLabel = document.createElement('span');
                anquanTagLabel.textContent = 'å®‰å…¨: ';
                anquanTagLabel.className = 'label';
                const anquanTagInput = document.createElement('select');
                anquanTagInput.className = 'select';
                const anquanOptions = ['1', '2', '3'];
                anquanOptions.forEach(optionValue => {
                    const option = document.createElement('option');
                    option.value = optionValue;
                    option.textContent = optionValue;
                    anquanTagInput.appendChild(option);
                });

                const xiaolvTagLabel = document.createElement('span');
                xiaolvTagLabel.textContent = 'æ•ˆç‡: ';
                xiaolvTagLabel.className = 'label';
                const xiaolvTagInput = document.createElement('select');
                xiaolvTagInput.className = 'select';
                const xiaolvOptions = ['1', '2', '3'];
                xiaolvOptions.forEach(optionValue => {
                    const option = document.createElement('option');
                    option.value = optionValue;
                    option.textContent = optionValue;
                    xiaolvTagInput.appendChild(option);
                });

                const shushiTagLabel = document.createElement('span');
                shushiTagLabel.textContent = 'èˆ’é€‚: ';
                shushiTagLabel.className = 'label';
                const shushiTagInput = document.createElement('select');
                shushiTagInput.className = 'select';
                const shushiOptions = ['1', '2', '3'];
                shushiOptions.forEach(optionValue => {
                    const option = document.createElement('option');
                    option.value = optionValue;
                    option.textContent = optionValue;
                    shushiTagInput.appendChild(option);
                });

                const remarkTagInput = document.createElement('input');
                remarkTagInput.type = 'text';
                remarkTagInput.placeholder = 'æè¿°';

                // ä¿®æ”¹åˆ›å»ºå…ƒç´ çš„ä»£ç ï¼Œç»™æ¯ä¸ªè¾“å…¥æ¡†/ä¸‹æ‹‰æ¡†æ·»åŠ å”¯ä¸€æ ‡è¯†
                startTimeInput.setAttribute('data-role', 'start-time');
                endTimeInput.setAttribute('data-role', 'end-time');
                sceneTagInput.setAttribute('data-role', 'scene-tag');
                difficultyTagInput.setAttribute('data-role', 'difficulty');
                anquanTagInput.setAttribute('data-role', 'anquan');
                xiaolvTagInput.setAttribute('data-role', 'xiaolv');
                shushiTagInput.setAttribute('data-role', 'shushi');
                remarkTagInput.setAttribute('data-role', 'remark');

                // å°†ç¼–å·å’Œè¾“å…¥æ¡†æ·»åŠ åˆ° timelineItem

                timelineItem.appendChild(startTimeInput);
                timelineItem.appendChild(endTimeInput);
                timelineItem.appendChild(sceneTagInput);
                timelineItem.appendChild(difficultyLabel);
                timelineItem.appendChild(difficultyTagInput);
                timelineItem.appendChild(anquanTagLabel);
                timelineItem.appendChild(anquanTagInput);
                timelineItem.appendChild(xiaolvTagLabel);
                timelineItem.appendChild(xiaolvTagInput);
                timelineItem.appendChild(shushiTagLabel);
                timelineItem.appendChild(shushiTagInput);
                timelineItem.appendChild(remarkTagInput);
                timelineItems.appendChild(timelineItem);

                // è‡ªåŠ¨æ»šåŠ¨åˆ°æ–°æ·»åŠ çš„å…ƒç´ 
                timelineItem.scrollIntoView({ behavior: 'smooth', block: 'center' });

                isStartTimeSet = true;
                lastStartTimeInput = endTimeInput;

                timelineItemCounter++; // å¢åŠ è®¡æ•°å™¨
            } else {
                lastStartTimeInput.value = formatTime(currentPausedTime);
                isStartTimeSet = false;
                lastStartTimeInput = null;
            }
        });

        // å¿«è¿›
        document.getElementById('fastForwardButton').addEventListener('click', function () {
            const video = document.querySelector('#videoContainer video');
            if (video) {
                video.currentTime += 1; // å¿«è¿›1ç§’
            }
        });

        // å¿«è¿›5ç§’
        document.getElementById('fastForward5Button').addEventListener('click', function () {
            const video = document.querySelector('#videoContainer video');
            if (video) {
                video.currentTime += 5; // å¿«è¿›1ç§’
            }
        });

        // åé€€
        document.getElementById('rewindButton').addEventListener('click', function () {
            const video = document.querySelector('#videoContainer video');
            if (video) {
                video.currentTime -= 1; // åé€€1ç§’
            }
        });

        document.getElementById('exportButton').addEventListener('click', function () {
            const timelineItems = document.querySelectorAll('.timeline-item');
            const timelineData = [];

            timelineItems.forEach((item, index) => {
                const startTime = item.querySelector('[data-role="start-time"]').value;
                const endTime = item.querySelector('[data-role="end-time"]').value;
                const sceneTag = item.querySelector('[data-role="scene-tag"]').value;
                const difficultyTag = item.querySelector('[data-role="difficulty"]').value;
                const anquanTag = item.querySelector('[data-role="anquan"]').value;
                const xiaolvTag = item.querySelector('[data-role="xiaolv"]').value;
                const shushiTag = item.querySelector('[data-role="shushi"]').value;
                const remarkTag = item.querySelector('[data-role="remark"]').value;
                timelineData.push({
                    number: index, // ç¼–å·ä» 0 å¼€å§‹
                    startTime,
                    endTime,
                    sceneTag,
                    difficultyTag,
                    anquanTag,
                    xiaolvTag,
                    shushiTag,
                    remarkTag
                });
            });

            let csvContent = "\uFEFFç¼–å·,å¼€å§‹æ—¶é—´,ç»“æŸæ—¶é—´,åœºæ™¯æ ‡ç­¾,åœºæ™¯éš¾åº¦,å®‰å…¨,æ•ˆç‡,èˆ’é€‚,æè¿°\n";
            timelineData.forEach(row => {
                csvContent += `${row.number},${row.startTime},${row.endTime},${row.sceneTag},${row.difficultyTag},${row.anquanTag},${row.xiaolvTag},${row.shushiTag},${row.remarkTag}\n`;
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const fileName = prompt("è¯·è¾“å…¥æ–‡ä»¶åï¼ˆä¸éœ€è¦æ‰©å±•åï¼‰", "timeline") || "timeline";
            const a = document.createElement('a');
            a.href = url;
            a.download = `${fileName}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        });
    </script>
</body>

</html>