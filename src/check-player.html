<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>场景校对</title>
    <script src="../js/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            height: 97vh;
            background-color: #f5f5f5;
        }
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 10px;
            border-radius: 5px;
            height: 30px;
            margin-bottom: 12px;
            flex-grow: 0;
            display: flex;
            align-items: center;
        }
        h1 {
            margin: 0;
            font-size: 24px;
        }
        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: nowrap;
            margin-bottom: 12px;
            flex-grow: 0;
        }
        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: white;
            padding: 5px 10px;
            border-radius: 5px;
            height: 30px;
            padding: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .file-input {
            width: 500px;
        }
        /* 添加拖拽区域样式 */
        .file-input.dragover {
            border: 2px dashed #3498db !important;
            background-color: #e8f4fc !important;
        }
        .status {
            display: flex;
            padding: 10px;
            background-color: #e8f4fc;
            border-radius: 4px;
            font-size: 14px;
            align-items: center;
            font-weight: bold;
            color: #2c3e50;
        }
        label {
            font-weight: bold;
            color: #2c3e50;
            font-size: 14px;
        }
        input[type="file"] {
            padding: 8px;
            background-color: white;
            height: 20px;
        }
        .container {
            display: flex;
            gap: 20px;
            flex-grow: 1;
        }
        .panel-header {
            display: flex;
            padding: 5px 20px;
            background-color: #3498db;
            color: white;
            font-weight: bold;
            height: 20px;
            align-items: center;
        }
        .data-panel {
            width: 40%;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        .data-container {
            flex: 1;
            overflow-y: auto;
            padding: 10px 15px;
            position: absolute;
            top: 30px;
            bottom: 10px;
            left: 0;
            right: 0;
        }
        input[type="text"] {
            border: none;
            outline: none;
            background-color: transparent;
            padding: 0px;
            width: 100%;
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 3px 3px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            position: sticky;
            top: 0;
            font-weight: bold;
            text-align: center;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tr:hover {
            background-color: #f0f0f0;
        }
        .time-cell {
            color: #2980b9;
            cursor: pointer;
            font-weight: bold;
        }
        .time-cell:hover {
            text-decoration: underline;
            color: #1a5276;
        }
        .video-panel {
            flex: 1;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .video-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            padding: 10px 15px;
        }
        video {
            width: 100%;
            max-height: 65vh;
            background-color: #000;
            border-radius: 4px;
            margin-bottom: 5px;
        }
        #buttonContainer {
            display: flex;
            justify-content: center;
            bottom: 0;
            left: 0;
            height: 24px;
            max-height: 10%;
            width: 100%;
            padding: 0 0 8px 0;
            gap: 5px;
        }
        .currenttext {
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            width: 100%;
            height: 24px;
            font-size: 18px;
            color: #333;
        }
        #currentTimeDisplay{
            display: flex;
            width: 160px;
            height: 24px;
            font-size: 18px;
            color: #333;
            align-items: center;
            text-align: center;
        }
        .controlbutton {
            width: 30px;
            height: 24px;
            font-size: 24px;
            cursor: pointer;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        button {
            padding: 5px 10px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        .highlight {
            background-color: #fffacd !important;
            box-shadow: 0 0 0 rgba(255, 235, 59, 0.6);
        }
        .current-time {
            position: absolute;
            right: 20px;
            top: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>汇总用改版</h1>
    </div>
    
    <div class="controls">
        <div class="control-group">
            <label for="excelFile">切片文件:</label>
            <input type="file" id="excelFile" accept=".xlsx, .xls" class="file-input" />
        </div>
        <div class="control-group">
            <label for="videoFile">视频文件:</label>
            <input type="file" id="videoFile" accept="video/*" class="file-input" />
        </div>
        <button id="exportButton">导出文件</button>
        <div class="status" id="status">
            请加载切片文件
        </div>
        <div class="status" id="videoStatus">
            请加载视频文件
        </div>
    </div>
    
    <div class="container">
        <div class="data-panel">
            <div class="panel-header">
                场景数据
            </div>
            <div class="data-container" id="dataContainer">
                <table id="dataTable">
                    <thead>
                        <tr>
                            <th style="width: 6%;">编号</th>
                            <th style="width: 12%;">开始时间</th>
                            <th style="width: 12%;">结束时间</th>
                            <th style="width: 12%;">场景标签</th>
                            <th style="width: 6%;">难度</th>
                            <th style="width: 17%;">异常情况备注</th>
                            <th style="width: 6%;">安全</th>
                            <th style="width: 6%;">效率</th>
                            <th style="width: 6%;">舒适</th>
                            <th style="width: 17%;">拟人化备注</th>
                        </tr>
                    </thead>
                    <tbody id="dataBody">
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="video-panel">
            <div class="panel-header">
                视频播放
            </div>
            <div class="video-container">
                <video id="videoPlayer" controls>
                    <source src="" type="video/mp4">
                    您的浏览器不支持视频播放
                </video>
            </div>
            <div class="currenttext" id="currentLabel">当前标签</div>
            <div id="buttonContainer">
                <div id="currentTimeDisplay">当前时间: 00:00:00</div>
                <button id="rewindButton" class="controlbutton">⏪</button>
                <button id="playButton" class="controlbutton">▶️</button>
                <button id="fastForwardButton" class="controlbutton">⏩</button>
            </div>
        </div>
    </div>

    <script>
        const excelFileInput = document.getElementById('excelFile');
        const videoFileInput = document.getElementById('videoFile');
        const videoPlayer = document.getElementById('videoPlayer');
        const dataBody = document.getElementById('dataBody');
        const statusElement = document.getElementById('status');
        const videoStatusElement = document.getElementById('videoStatus');
        const currentTimeElement = document.getElementById('currentTime');
        const currentLable = document.getElementById('currentLabel');
        const playButton =document.getElementById('playButton');
        
        let sceneData = [];
        let highlightTimer = null;
        let lastHighlightedRow = null;
        let sceneCounter = 0;
        
        excelFileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
           
            sceneData = [];
            dataBody.innerHTML = '';
            
            statusElement.textContent = `正在加载场景数据: ${file.name}...`;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array', cellDates: true });
                    
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: "" });
                    
                    processSceneData(jsonData);
                    
                    statusElement.textContent = `已加载 ${sceneData.length} 个场景数据`;
                } catch (error) {
                    statusElement.textContent = `加载失败: ${error.message}`;
                    console.error(error);
                }
            };
            reader.readAsArrayBuffer(file);
        });
        
        // 添加拖拽事件监听器到Excel文件输入框
        excelFileInput.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('dragover');
        });
        
        excelFileInput.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
        });
        
        excelFileInput.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                // 创建一个事件来触发文件选择
                const event = new Event('change', { bubbles: true });
                this.files = files;
                this.dispatchEvent(event);
            }
        });
        
        videoFileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            videoStatusElement.textContent = `正在加载视频: ${file.name}...`;
            
            const videoURL = URL.createObjectURL(file);
            videoPlayer.src = videoURL;
            
            videoPlayer.onloadeddata = function() {
                videoStatusElement.textContent = `已加载视频 (时长: ${formatTime(videoPlayer.duration)})`;
                setupVideoTimeTracking();
            };
            
            videoPlayer.onerror = function() {
                videoStatusElement.textContent = "视频加载失败";
            };
        });
        
        // 添加拖拽事件监听器到视频文件输入框
        videoFileInput.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('dragover');
        });
        
        videoFileInput.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
        });
        
        videoFileInput.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                // 创建一个事件来触发文件选择
                const event = new Event('change', { bubbles: true });
                this.files = files;
                this.dispatchEvent(event);
            }
        });
        
        function setupVideoTimeTracking() {
            if (highlightTimer) {
                clearInterval(highlightTimer);
            }
            videoPlayer.ontimeupdate = function() {
                const currentTime = formatTime(videoPlayer.currentTime);
                currentTimeDisplay.textContent = `当前时间: ${currentTime}`;
                if (videoPlayer.paused) {
                    playButton.textContent = '▶️';
                } else {
                    playButton.textContent = '⏸️';
                }
            };
            highlightTimer = setInterval(function() {
                checkCurrentSceneHighlight();
            }, 1000);
        }
        
        function checkCurrentSceneHighlight() {
            if (!videoPlayer.src || sceneData.length === 0) return;
            
            const currentTime = videoPlayer.currentTime;
            let currentSceneIndex = -1;
            
            for (let i = 0; i < sceneData.length; i++) {
                const scene = sceneData[i];
                const startTime = convertToSeconds(formatExcelTime(scene.startTime));
                const endTime = convertToSeconds(formatExcelTime(scene.endTime));
                
                if (currentTime >= startTime && currentTime <= endTime) {
                    currentSceneIndex = i;
                    break;
                }
            }
            
            updateHighlight(currentSceneIndex);
        }
        
        function updateHighlight(rowIndex) {
            if (lastHighlightedRow !== null) {
                const rows = document.querySelectorAll('#dataBody tr');
                if (lastHighlightedRow >= 0 && lastHighlightedRow < rows.length) {
                    rows[lastHighlightedRow].classList.remove('highlight');
                }
            }

            if (rowIndex >= 0) {
                const rows = document.querySelectorAll('#dataBody tr');
                if (rowIndex < rows.length) {
                    const currentRow = rows[rowIndex];
                    currentRow.classList.add('highlight');

                    const labelInput = currentRow.querySelector('textarea');
                    if (sceneData[rowIndex].label) {
                        const labelMapping = {
                            1: "左转-无博弈",
                            2: "左转-同向车辆博弈",
                            3: "左转-对向转弯车辆博弈",
                            4: "左转-VRU博弈",
                            5: "左转-待行区",
                            6: "直行-无博弈",
                            7: "直行-有博弈",
                            8: "直行-待行区",
                            9: "右转-无博弈",
                            10: "右转-同向车辆博弈",
                            11: "右转-对向转弯车辆博弈",
                            12: "右转-VRU博弈",
                            13: "环岛-有信号灯",
                            14: "环岛-无信号灯",
                            15: "掉头-无博弈",
                            16: "掉头-有博弈",
                            17: "车道保持与跟车",
                            18: "拥堵跟车",
                            19: "导航变道",
                            20: "切入避让",
                            21: "绕行占道车辆与行人",
                            22: "窄路-绕行同向车辆与VRU",
                            23: "超越慢车",
                            24: "对向会车",
                            25: "窄路-对向车辆与VRU博弈",
                            26: "窄路-掉头",
                            27: "出主路进辅路",
                            28: "出辅路进主路",
                            29: "城快匝道内分流",
                            30: "城快匝道内合流",
                            31: "上匝道汇入城快",
                            32: "出城快下匝道",
                            33: "施工区域通行",
                            34: "左转-对向直行车辆博弈",
                            35: "学校区域通行",
                            36: "隧道通行",
                            37: "收费站通行",
                            38: "交警-有指挥",
                            39: "交警-无指挥",
                            40: "违反交规",
                            41: "驾驶员紧急干预及接管",
                            42: "驾驶员主动干预",
                            43: "系统请求接管",
                            44: "无效数据",
                            45: "避让横穿VRU",
                            46: "复杂狭窄巷道通行"
                        };

                        const updateLabel = ((String(sceneData[rowIndex].label)).replace(/ /g, '，') || '').replace(/\b\d+\b/g, match => labelMapping[match] || match);
                        currentLable.textContent = `${updateLabel}`;
                    }

                    const rowRect = currentRow.getBoundingClientRect();
                    const containerRect = document.getElementById('dataContainer').getBoundingClientRect();

                    if (rowRect.bottom > containerRect.bottom || rowRect.top < containerRect.top) {
                        if (!videoPlayer.paused) {
                            currentRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    }
                }
            }

            lastHighlightedRow = rowIndex;
        }

        function processSceneData(data) {
            sceneData = [];
            const nrhOption = false;
            data.forEach(row => {
                sceneData.push({
                    number: '切分场景编号' in row ? row['切分场景编号'] : row['编号'],
                    startTime: '场景开始时间戳' in row ? row['场景开始时间戳'] : row['开始时间'] || '',
                    endTime: '场景结束时间戳' in row ? row['场景结束时间戳'] : row['结束时间'] || '',
                    label: '场景标签号' in row ? row['场景标签号'] : row['场景标签'] || '',
                    difficulty: '场景难易程度' in row ? row['场景难易程度'] : ('场景难度' in row ? row['场景难度'] : row['难度'] || ''),
                    remark: '异常情况备注' in row ? row['异常情况备注'] : row['描述'] || '',
                    anquan: nrhOption ? '' : ('安全性得分' in row ? row['安全性得分'] : ('安全' in row ? row['安全'] : '')),
                    xiaolv: nrhOption ? '' : ('效率性得分' in row ? row['效率性得分'] : ('效率' in row ? row['效率'] : '')),
                    shushi: nrhOption ? '' : ('舒适性得分' in row ? row['舒适性得分'] : ('舒适' in row ? row['舒适'] : '')),
                    nrhremark: nrhOption ? '' : ('拟人化异常情况备注' in row ? row['拟人化异常情况备注'] : ('拟人化情况备注' in row ? row['拟人化情况备注'] : ('拟人化描述' in row ? row['拟人化描述'] : '')))
                });
            });

            renderSceneData();
        }

        function addSceneData() {

        }
        
        function renderSceneData() {
            dataBody.innerHTML = '';
            
            sceneData.forEach((scene, index) => {
                const row = document.createElement('tr');
                row.dataset.index = index;

                const numberCell = document.createElement('td');
                numberCell.textContent = scene.number;
                numberCell.style.textAlign = 'center';
                sceneCounter = scene.number;

                const startCell = document.createElement('td');
                startCell.className = 'time-cell';
                startCell.textContent = formatExcelTime(scene.startTime);
                startCell.dataset.time = convertToSeconds(startCell.textContent);
                startCell.title = "点击跳转到场景开始时间";
                startCell.style.textAlign = 'center';
                startCell.onclick = function() {
                    jumpToVideoTime(this.dataset.time, index);
                };

                const endCell = document.createElement('td');
                endCell.className = 'time-cell';
                endCell.textContent = formatExcelTime(scene.endTime);
                endCell.dataset.time = convertToSeconds(endCell.textContent);
                endCell.title = "点击跳转到场景结束时间";
                endCell.style.textAlign = 'center';
                endCell.onclick = function() {
                    jumpToVideoTime(this.dataset.time, index);
                };

                const labelCell = document.createElement('td');
                const labelInput = document.createElement('input');
                labelInput.type = 'text';
                labelInput.value = scene.label;
                labelInput.addEventListener('input', function () {
                    sceneData[index].label = labelInput.value;
                });
                labelCell.appendChild(labelInput);

                const difficultyCell = document.createElement('td');
                const difficultyInput = document.createElement('input');
                difficultyInput.type = 'text';
                difficultyInput.value = scene.difficulty;
                difficultyInput.addEventListener('input', function () {
                    sceneData[index].difficulty = difficultyInput.value;
                });
                difficultyCell.appendChild(difficultyInput);

                const remarkCell = document.createElement('td');
                const remarkInput = document.createElement('input');
                remarkInput.type = 'text';
                remarkInput.value = scene.remark;
                remarkInput.style.textAlign = 'left';
                remarkInput.addEventListener('input', function () {
                    sceneData[index].remark = remarkInput.value;
                });
                remarkCell.appendChild(remarkInput);

                const anquanCell = document.createElement('td');
                const anquanInput = document.createElement('input');
                anquanInput.type = 'text';
                anquanInput.value = scene.anquan;
                anquanInput.addEventListener('input', function () {
                    sceneData[index].anquan = anquanInput.value;
                });
                anquanCell.appendChild(anquanInput);

                const xiaolvCell = document.createElement('td');
                const xiaolvInput = document.createElement('input');
                xiaolvInput.type = 'text';
                xiaolvInput.value = scene.xiaolv;
                xiaolvInput.addEventListener('input', function () {
                    sceneData[index].xiaolv = xiaolvInput.value;
                });
                xiaolvCell.appendChild(xiaolvInput);

                const shushiCell = document.createElement('td');
                const shushiInput = document.createElement('input');
                shushiInput.type = 'text';
                shushiInput.value = scene.shushi;
                shushiInput.addEventListener('input', function () {
                    sceneData[index].shushi = shushiInput.value;
                });
                shushiCell.appendChild(shushiInput);

                const nrhremarkCell = document.createElement('td');
                const nrhremarkInput = document.createElement('input');
                nrhremarkInput.type = 'text';
                nrhremarkInput.value = scene.nrhremark;
                nrhremarkInput.style.textAlign = 'left';
                nrhremarkInput.addEventListener('input', function () {
                    sceneData[index].nrhremark = nrhremarkInput.value;
                });
                nrhremarkCell.appendChild(nrhremarkInput);

                row.appendChild(numberCell);
                row.appendChild(startCell);
                row.appendChild(endCell);
                row.appendChild(labelCell);
                row.appendChild(difficultyCell);
                row.appendChild(remarkCell);
                row.appendChild(anquanCell);
                row.appendChild(xiaolvCell);
                row.appendChild(shushiCell);
                row.appendChild(nrhremarkCell);

                dataBody.appendChild(row);
            });
        }
        
        function formatExcelTime(time) {
            if (time instanceof Date && isNaN(time.getTime())) {
            const rawValue = time.valueOf();
            const numericValue = parseFloat(rawValue)
            const baseDate = new Date(Date.UTC(1899, 11, 30));
            const excelDate = new Date(baseDate.getTime() + numericValue * 86400 * 1000);
            const hours = excelDate.getUTCHours().toString().padStart(2, '0');
            const minutes = excelDate.getUTCMinutes().toString().padStart(2, '0');
            const seconds = excelDate.getUTCSeconds().toString().padStart(2, '0');
            return `${hours}:${minutes}:${seconds}`;
            } else if (time instanceof Date) {
                const hours = time.getHours().toString().padStart(2, '0');
                const minutes = time.getMinutes().toString().padStart(2, '0');
                const seconds = time.getSeconds().toString().padStart(2, '0');
                return `${hours}:${minutes}:${seconds}`;
            } else if (typeof time === 'number') {
                const totalSeconds = time * 86400;
                const hours = Math.floor(totalSeconds / 3600).toString().padStart(2, '0');
                const minutes = Math.floor((totalSeconds % 3600) / 60).toString().padStart(2, '0');
                const seconds = Math.floor(totalSeconds % 60).toString().padStart(2, '0');
                return `${hours}:${minutes}:${seconds}`;
            } else if (typeof time === 'string' && /^\d{1,2}:\d{2}:\d{2}$/.test(time)) {
                const parts = time.split(':');
                if (parts[0].length === 1) {
                    parts[0] = parts[0].padStart(2, '0');
                }
                return parts.join(':');
            }
            return time;
        }
        
        function convertToSeconds(timeString) {
            if (typeof timeString === 'string' && /^\d{2}:\d{2}:\d{2}$/.test(timeString)) {
                const [hours, minutes, seconds] = timeString.split(':').map(Number);
                return hours * 3600 + minutes * 60 + seconds;
            }
            return 0;
        }
        
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600).toString().padStart(2, '0');
            const minutes = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
            const secs = Math.floor(seconds % 60).toString().padStart(2, '0');
            return `${hours}:${minutes}:${secs}`;
        }
        
        function jumpToVideoTime(timeInSeconds, rowIndex) {
            if (!videoPlayer.src) {
                videoStatusElement.textContent = "请先加载视频文件";
                return;
            }
            
            videoPlayer.currentTime = parseFloat(timeInSeconds);
            videoPlayer.play();
            
            videoStatusElement.textContent = `跳转到: ${formatTime(timeInSeconds)}`;
            
            updateHighlight(rowIndex);
        }

        const exportButton = document.getElementById('exportButton');
        let loadedExcelFileName = '';

        excelFileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                loadedExcelFileName = file.name.split('.').slice(0, -1).join('.');
            }
        });

        exportButton.addEventListener('click', function() {
            if (sceneData.length === 0) {
                alert('没有可导出的场景数据！');
                return;
            }

            const worksheet = XLSX.utils.json_to_sheet(sceneData.map(scene => ({
                编号: Number(scene.number) || 0,
                开始时间: scene.startTime,
                结束时间: scene.endTime,
                场景标签: scene.label,
                难度: Number(scene.difficulty),
                异常情况备注: scene.remark,
                安全: Number(scene.anquan) || 1,
                效率: Number(scene.xiaolv) || 1,
                舒适: Number(scene.shushi) || 1,
                总分: Math.max(Number(scene.anquan) || 1, Number(scene.xiaolv) || 1, Number(scene.shushi) || 1),
                拟人化情况备注: scene.nrhremark
            })));
            ['A', 'E', 'G', 'H', 'I', 'J'].forEach(col => {
                for (let row = 2; row <= sceneData.length + 1; row++) {
                    const cell = worksheet[`${col}${row}`];
                    if (cell) {
                        cell.t = 'n';
                    }
                }
            });
            ['B', 'C'].forEach(col => {
                for (let row = 2; row <= sceneData.length + 1; row++) {
                    const cell = worksheet[`${col}${row}`];
                    if (cell) {
                        cell.z = 'hh:mm:ss';
                    }
                }
            });
            ['D', 'F', 'K'].forEach(col => {
                for (let row = 2; row <= sceneData.length + 1; row++) {
                    const cell = worksheet[`${col}${row}`];
                    if (cell) {
                        cell.t = 's';
                    }
                }
            });
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, '校验数据');

            const exportFileName = `${loadedExcelFileName || '场景数据'}_校验.xlsx`;

            XLSX.writeFile(workbook, exportFileName);
        });

        document.getElementById('playButton').addEventListener('click', function () {
            if (videoPlayer.paused) {
                videoPlayer.play();
            }
            else {
                videoPlayer.pause();
            }
        });
        
        document.getElementById('fastForwardButton').addEventListener('click', function () {
            if (videoPlayer) {
                videoPlayer.currentTime += 1;
            }
        });
         
        document.getElementById('rewindButton').addEventListener('click', function () {
            if (videoPlayer) {
                videoPlayer.currentTime -= 1;
            }
        });

    </script>
</body>
</html>