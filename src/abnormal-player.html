<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>异常数据复查</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            height: 97vh;
            background-color: #f5f5f5;
        }
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 10px;
            border-radius: 5px;
            height: 30px;
            margin-bottom: 12px;
            flex-grow: 0;
            display: flex;
            align-items: center;
        }
        h1 {
            margin: 0;
            font-size: 24px;
        }
        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: nowrap;
            margin-bottom: 12px;
            flex-grow: 0;
        }
        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: white;
            padding: 5px 10px;
            border-radius: 5px;
            height: 30px;
            padding: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .status {
            display: flex;
            padding: 10px;
            background-color: #e8f4fc;
            border-radius: 4px;
            font-size: 14px;
            align-items: center;
            font-weight: bold;
            color: #2c3e50;
        }
        label {
            font-weight: bold;
            color: #2c3e50;
            font-size: 14px;
        }
        input[type="file"] {
            padding: 8px;
            background-color: white;
            height: 20px;
        }
        .container {
            display: flex;
            gap: 20px;
            flex-grow: 1;
        }
        .panel-header {
            display: flex;
            padding: 5px 20px;
            background-color: #3498db;
            color: white;
            font-weight: bold;
            height: 20px;
            align-items: center;
        }
        .data-panel {
            width: 50%;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        .data-container {
            flex: 1;
            overflow-y: auto;
            padding: 10px 15px;
            position: absolute;
            top: 30px;
            bottom: 10px;
            left: 0;
            right: 0;
        }
        input[type="text"] {
            border: none;
            outline: none;
            background-color: transparent;
            padding: 0px;
            width: 100%;
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 3px 3px;
            text-align: left;
            word-wrap: break-word;
            word-break: break-all;
            white-space: normal;
        }
        th {
            background-color: #f2f2f2;
            position: sticky;
            top: 0;
            font-weight: bold;
            text-align: center;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tr:hover {
            background-color: #f0f0f0;
        }
        .time-cell {
            color: #2980b9;
            cursor: pointer;
            font-weight: bold;
        }
        .time-cell:hover {
            text-decoration: underline;
            color: #1a5276;
        }
        .video-panel {
            flex: 1;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .video-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            padding: 10px 15px;
        }
        video {
            width: 100%;
            max-height: 65vh;
            background-color: #000;
            border-radius: 4px;
            margin-bottom: 5px;
        }
        #buttonContainer {
            display: flex;
            justify-content: center;
            /* 固定位置 */
            bottom: 0;
            /* 锁定到页面底部 */
            left: 0;
            height: 24px;
            max-height: 10%;
            width: 100%;
            padding: 0 0 8px 0;
            gap: 5px;
        }
        .currenttext {
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            width: 100%;
            height: 24px;
            font-size: 18px;
            color: #333;
        }
        #currentTimeDisplay{
            display: flex;
            width: 160px;
            height: 24px;
            font-size: 18px;
            color: #333;
            align-items: center;
            text-align: center;
        }
        .controlbutton {
            width: 30px;
            height: 24px;
            font-size: 24px;
            cursor: pointer;
            background-color: white;
            display: flex;
            align-items: center;    /* 垂直居中 */
            justify-content: center; /* 水平居中 */
        }
        button {
            padding: 5px 10px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        .highlight {
            background-color: #fffacd !important;
            box-shadow: 0 0 0 rgba(255, 235, 59, 0.6);
        }
        .current-time {
            position: absolute;
            right: 20px;
            top: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>异常数据复查</h1>
    </div>
    
    <div class="controls">
        <div class="control-group">
            <label for="excelFile">切片文件:</label>
            <input type="file" id="excelFile" accept=".xlsx, .xls" />
        </div>
        <div class="control-group">
            <label for="videoFile">视频文件:</label>
            <input type="file" id="videoFile" accept="video/*" />
        </div>
        <!-- <div class="control-group">
            <label for="nrhoption">导入拟人化</label>
            <input type="radio" id="optionNo" name="importData" value="no" >
            <label for="optionNoNo">否</label>
            <input type="radio" id="optionYes" name="importData" value="yes" checked>
            <label for="optionYes">是</label>
        </div> -->
        <button id="exportButton">导出文件</button>
        <div class="status" id="status">
            请加载切片文件
        </div>
        <div class="status" id="videoStatus">
            请加载视频文件
        </div>
    </div>
    
    <div class="container">
        <div class="data-panel">
            <div class="panel-header">
                场景数据
            </div>
            <div class="data-container" id="dataContainer">
                <table id="dataTable">
                    <thead>
                        <tr>
                            <th style="width: 16%;">线路名称</th>
                            <th style="width: 8%;">车型</th>
                            <th style="width: 5%;">编号</th>
                            <th style="width: 10%;">视频名称</th>
                            <th style="width: 7%;">开始时间</th>
                            <th style="width: 7%;">结束时间</th>
                            <th style="width: 5%;">标签</th>
                            <th style="width: 10%;">接管类型</th>
                            <th style="width: 16%;">描述与原因</th>
                            <th style="width: 16%;">复查意见</th>
                        </tr>
                    </thead>
                    <tbody id="dataBody">
                        <!-- 数据将通过JavaScript动态加载 -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="video-panel">
            <div class="panel-header">
                视频播放
            </div>
            <div class="video-container">
                <!-- <div class="current-time" id="currentTime">00:00:00</div> -->
                <video id="videoPlayer" controls>
                    <source src="" type="video/mp4">
                    您的浏览器不支持视频播放
                </video>
            </div>
            <div class="currenttext" id="currentLabel">当前标签</div>
            <div id="buttonContainer">
                <div id="currentTimeDisplay">当前时间: 00:00:00</div>
                <button id="rewindButton" class="controlbutton">⏪</button>
                <button id="playButton" class="controlbutton">▶️</button>
                <button id="fastForwardButton" class="controlbutton">⏩</button>
            </div>
        </div>
    </div>

    <script>
        // 获取DOM元素
        const excelFileInput = document.getElementById('excelFile');
        const videoFileInput = document.getElementById('videoFile');
        const videoPlayer = document.getElementById('videoPlayer');
        const dataBody = document.getElementById('dataBody');
        const statusElement = document.getElementById('status');
        const videoStatusElement = document.getElementById('videoStatus');
        const currentTimeElement = document.getElementById('currentTime');
        const currentLable = document.getElementById('currentLabel');
        const playButton =document.getElementById('playButton');
        
        // 存储Excel数据
        let sceneData = [];
        let highlightTimer = null;
        let lastHighlightedRow = null;
        let currentSceneIndex = -1
        
        // 监听Excel文件选择
        excelFileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
           
            // 清空原来的 sceneData 数据
            sceneData = [];
            dataBody.innerHTML = ''; // 清空表格内容
            
            statusElement.textContent = `正在加载场景数据: ${file.name}...`;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array', cellDates: true });
                    
                    // 获取第一个工作表
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // 转换为JSON
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: "" });
                    
                    // 处理数据
                    processSceneData(jsonData);
                    
                    statusElement.textContent = `已加载 ${sceneData.length} 个场景数据`;
                } catch (error) {
                    statusElement.textContent = `加载失败: ${error.message}`;
                    console.error(error);
                }
            };
            reader.readAsArrayBuffer(file);
        });
        
        // 监听视频文件选择
        videoFileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            videoStatusElement.textContent = `正在加载视频: ${file.name}...`;
            
            const videoURL = URL.createObjectURL(file);
            videoPlayer.src = videoURL;
            
            videoPlayer.onloadeddata = function() {
                videoStatusElement.textContent = `已加载视频 (时长: ${formatTime(videoPlayer.duration)})`;
                setupVideoTimeTracking();
            };
            
            videoPlayer.onerror = function() {
                videoStatusElement.textContent = "视频加载失败";
            };
        });
        
        // 设置视频时间跟踪
        function setupVideoTimeTracking() {
            // 清除之前的定时器
            if (highlightTimer) {
                clearInterval(highlightTimer);
            }
            // 更新当前时间显示
            videoPlayer.ontimeupdate = function() {
                const currentTime = formatTime(videoPlayer.currentTime);
                currentTimeDisplay.textContent = `当前时间: ${currentTime}`;
                if (videoPlayer.paused) {
                    playButton.textContent = '▶️';
                } else {
                    playButton.textContent = '⏸️';
                }
            };
            // 每秒检查一次是否需要高亮场景
            highlightTimer = setInterval(function() {
                checkCurrentSceneHighlight();
            }, 500);
        }
        
        // 检查并高亮当前场景
        function checkCurrentSceneHighlight() {
            // if (!videoPlayer.src || sceneData.length === 0) return;
            
            // const currentTime = videoPlayer.currentTime;
            // let currentSceneIndex = -1;
            
            // // 查找当前时间所在的场景
            // for (let i = 0; i < sceneData.length; i++) {
            //     const scene = sceneData[i];
            //     const startTime = convertToSeconds(formatExcelTime(scene.startTime));
            //     const endTime = convertToSeconds(formatExcelTime(scene.endTime));
                
            //     if (currentTime >= startTime && currentTime <= endTime) {
            //         currentSceneIndex = i;
            //         break;
            //     }
            // }
            
            // 更新高亮状态
            updateHighlight(currentSceneIndex);
        }
        
        // 更新高亮行
        function updateHighlight(rowIndex) {
            // 清除之前的高亮
            if (lastHighlightedRow !== null) {
                const rows = document.querySelectorAll('#dataBody tr');
                if (lastHighlightedRow >= 0 && lastHighlightedRow < rows.length) {
                    rows[lastHighlightedRow].classList.remove('highlight');
                }
            }

            // 添加新的高亮
            if (rowIndex >= 0) {
                const rows = document.querySelectorAll('#dataBody tr');
                if (rowIndex < rows.length) {
                    const currentRow = rows[rowIndex];
                    currentRow.classList.add('highlight');

                    // 获取当前行的 labelInput
                    const labelInput = currentRow.querySelector('textarea');
                    console.log(`当前行的标签: ${sceneData[rowIndex].label}`);
                    if (sceneData[rowIndex].label) {
                        const labelMapping = {
                            1: "左转-无博弈",
                            2: "左转-同向车辆博弈",
                            3: "左转-对向转弯车辆博弈",
                            4: "左转-VRU博弈",
                            5: "左转-待行区",
                            6: "直行-无博弈",
                            7: "直行-有博弈",
                            8: "直行-待行区",
                            9: "右转-无博弈",
                            10: "右转-同向车辆博弈",
                            11: "右转-对向转弯车辆博弈",
                            12: "右转-VRU博弈",
                            13: "环岛-有信号灯",
                            14: "环岛-无信号灯",
                            15: "掉头-无博弈",
                            16: "掉头-有博弈",
                            17: "车道保持与跟车",
                            18: "拥堵跟车",
                            19: "导航变道",
                            20: "切入避让",
                            21: "绕行占道车辆与行人",
                            22: "窄路-绕行同向车辆与VRU",
                            23: "超越慢车",
                            24: "对向会车",
                            25: "窄路-对向车辆与VRU博弈",
                            26: "窄路-掉头",
                            27: "出主路进辅路",
                            28: "出辅路进主路",
                            29: "城快匝道内分流",
                            30: "城快匝道内合流",
                            31: "上匝道汇入城快",
                            32: "出城快下匝道",
                            33: "施工区域通行",
                            34: "左转-对向直行车辆博弈",
                            35: "学校区域通行",
                            36: "隧道通行",
                            37: "收费站通行",
                            38: "交警-有指挥",
                            39: "交警-无指挥",
                            40: "违反交规",
                            41: "驾驶员紧急干预及接管",
                            42: "驾驶员主动干预",
                            43: "系统请求接管",
                            44: "无效数据",
                            45: "避让横穿VRU",
                            46: "复杂狭窄巷道通行"
                        };

                        // 替换 labelInput 的内容
                        const updateLabel = ((String(sceneData[rowIndex].label)).replace(/ /g, '，') || '').replace(/\b\d+\b/g, match => labelMapping[match] || match);
                        const difficulty = sceneData[rowIndex].difficulty;
                        console.log(`当前难度：${difficulty} 当前标签: ${updateLabel}`);
                        currentLable.textContent = `难度:${difficulty} ${updateLabel}`;
                    }

                    // 如果行不在可视区域内，则滚动到该行
                    const rowRect = currentRow.getBoundingClientRect();
                    const containerRect = document.getElementById('dataContainer').getBoundingClientRect();

                    if (rowRect.bottom > containerRect.bottom || rowRect.top < containerRect.top) {
                        if (!videoPlayer.paused) {
                            currentRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    }
                }
            }

            lastHighlightedRow = rowIndex;
        }

        // 处理场景数据
        function processSceneData(data) {
            sceneData = [];
            data.forEach(row => {
                // 检查必需字段是否存在
                // if (row['编号'] === undefined && row['切分场景编号'] === undefined) {
                //     return; // 跳过不完整的数据行
                // }
                sceneData.push({
                    test: '线路名称' in row ? row['线路名称'] : row['线路'] || '',
                    car: row['车型'] || '',
                    number: '核查编号' in row ? row['核查编号'] : row['编号'],
                    video: row['视频名称'] || '',
                    startTime: row['接管时刻'] || '',
                    endTime: row['恢复时刻'] || '',
                    takeover: row['接管类型/拟人化程度'] || '',
                    label: '场景标签号' in row ? row['场景标签号'] :row['场景标签'] || '',
                    remark: '描述与原因' in row ? row['描述与原因'] : row['描述'] || ''
                });
            });

            renderSceneData();
        }

        function addSceneData() {

        }
        // 渲染场景数据表格
        function renderSceneData() {
            dataBody.innerHTML = '';
            
            sceneData.forEach((scene, index) => {
                const row = document.createElement('tr');
                row.dataset.index = index;

                // 测试名称
                const testCell = document.createElement('td');
                testCell.textContent = scene.test;
                testCell.style.textAlign = 'left';

                // 车型
                const carCell = document.createElement('td');
                carCell.textContent = scene.car;
                carCell.style.textAlign = 'center';

                // 核查编号
                const numberCell = document.createElement('td');
                numberCell.textContent = scene.number;
                numberCell.style.textAlign = 'center';

                // 视频名称
                const videoCell = document.createElement('td');
                videoCell.textContent = scene.video;
                videoCell.style.textAlign = 'center';

                // 开始时间
                const startCell = document.createElement('td');
                startCell.className = 'time-cell';
                startCell.textContent = formatExcelTime(scene.startTime);
                startCell.dataset.time = convertToSeconds(startCell.textContent);
                startCell.title = "点击跳转到场景开始时间";
                startCell.style.textAlign = 'center';
                startCell.onclick = function () {
                    locateSceneByTime(this.dataset.time, index);
                };

                // 结束时间
                const endCell = document.createElement('td');
                endCell.className = 'time-cell';
                endCell.textContent = formatExcelTime(scene.endTime);
                endCell.dataset.time = convertToSeconds(endCell.textContent);
                endCell.title = "点击跳转到场景结束时间";
                endCell.style.textAlign = 'center';
                endCell.onclick = function () {
                    locateSceneByTime(this.dataset.time, index);
                };

                // 场景标签
                const labelCell = document.createElement('td');
                labelCell.textContent = scene.label;
                labelCell.style.textAlign = 'center';

                // 接管类型
                const takeoverCell = document.createElement('td');
                takeoverCell.textContent = scene.takeover;
                takeoverCell.style.textAlign = 'center';

                // 异常情况备注
                const remarkCell = document.createElement('td');
                remarkCell.textContent = scene.remark;
                remarkCell.style.textAlign = 'left';

                // 复查意见
                const checkCell = document.createElement('td');
                const checkInput = document.createElement('input');
                checkInput.type = 'text';
                checkInput.style.textAlign = 'left';
                checkInput.onchange = function () {
                    scene.check = this.value;
                };
                checkCell.appendChild(checkInput);

                // 添加到行
                row.appendChild(testCell);
                row.appendChild(carCell);
                row.appendChild(numberCell);
                row.appendChild(videoCell);
                row.appendChild(startCell);
                row.appendChild(endCell);
                row.appendChild(labelCell);
                row.appendChild(takeoverCell);
                row.appendChild(remarkCell);
                row.appendChild(checkCell);

                // 添加到表格
                dataBody.appendChild(row);
            });
        }

        // 新增函数：根据时间戳定位场景
        function locateSceneByTime(timeInSeconds, rowIndex) {
            if (!videoPlayer.src) {
                videoStatusElement.textContent = "请先加载视频文件";
                return;
            }

            // 跳转视频时间
            videoPlayer.currentTime = parseFloat(timeInSeconds);
            videoPlayer.play();

            // 更新状态
            videoStatusElement.textContent = `跳转到: ${formatTime(timeInSeconds)}`;

            // 高亮当前行
            currentSceneIndex = rowIndex;
        }
        
        // 格式化Excel时间（支持日期对象、数字格式和字符串格式）
        function formatExcelTime(time) {
            if (time instanceof Date && isNaN(time.getTime())) {
            // 如果是无效的 Date 对象，尝试将其视为 Excel 时间格式的数字
            const rawValue = time.valueOf(); // 获取原始值
            //const rawValue = time.v
            const numericValue = parseFloat(rawValue)
            const baseDate = new Date(Date.UTC(1899, 11, 30)); // Excel 时间基准日期（UTC 时间）
            const excelDate = new Date(baseDate.getTime() + numericValue * 86400 * 1000); // 转换为毫秒
            const hours = excelDate.getUTCHours().toString().padStart(2, '0');
            const minutes = excelDate.getUTCMinutes().toString().padStart(2, '0');
            const seconds = excelDate.getUTCSeconds().toString().padStart(2, '0');
            console.log(`时间格式为: datenumber ${time} ${hours}:${minutes}:${seconds}`);
            return `${hours}:${minutes}:${seconds}`;
            } else if (time instanceof Date) {
                // 处理日期对象
                const hours = time.getHours().toString().padStart(2, '0');
                const minutes = time.getMinutes().toString().padStart(2, '0');
                const seconds = time.getSeconds().toString().padStart(2, '0');
                return `${hours}:${minutes}:${seconds}`;
            } else if (typeof time === 'number') {
                // 处理Excel数字时间格式（1 = 1天 = 24小时）
                const totalSeconds = time * 86400;
                const hours = Math.floor(totalSeconds / 3600).toString().padStart(2, '0');
                const minutes = Math.floor((totalSeconds % 3600) / 60).toString().padStart(2, '0');
                const seconds = Math.floor(totalSeconds % 60).toString().padStart(2, '0');
                return `${hours}:${minutes}:${seconds}`;
            } else if (typeof time === 'string' && /^\d{1,2}:\d{2}:\d{2}$/.test(time)) {
                // 处理字符串格式的时间（H:MM:SS 或 HH:MM:SS）
                const parts = time.split(':');
                if (parts[0].length === 1) {
                    // 如果小时部分是单个数字，补齐为两位
                    parts[0] = parts[0].padStart(2, '0');
                }
                return parts.join(':');
            }
            return time; // 如果不是时间格式，返回原始值
        }
        
        // 将时间转换为秒数
        // function convertToSeconds(time) {
        //     if (time instanceof Date) {
        //         return time.getHours() * 3600 + time.getMinutes() * 60 + time.getSeconds();
        //     } else if (typeof time === 'number') {
        //         return time * 86400; // Excel时间格式，1 = 24小时
        //     }
        //     return 0;
        // }

        function convertToSeconds(timeString) {
            if (typeof timeString === 'string' && /^\d{2}:\d{2}:\d{2}$/.test(timeString)) {
                const [hours, minutes, seconds] = timeString.split(':').map(Number);
                return hours * 3600 + minutes * 60 + seconds;
            }
            return 0; // 如果格式不正确，返回0
        }
        
        // 格式化时间为HH:MM:SS
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600).toString().padStart(2, '0');
            const minutes = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
            const secs = Math.floor(seconds % 60).toString().padStart(2, '0');
            return `${hours}:${minutes}:${secs}`;
        }
        
        // 跳转到视频指定时间
        function jumpToVideoTime(timeInSeconds, rowIndex) {
            if (!videoPlayer.src) {
                videoStatusElement.textContent = "请先加载视频文件";
                return;
            }
            
            // 跳转视频时间
            videoPlayer.currentTime = parseFloat(timeInSeconds);
            videoPlayer.play();
            
            // 更新状态
            videoStatusElement.textContent = `跳转到: ${formatTime(timeInSeconds)}`;
            
            // 高亮当前行
            updateHighlight(rowIndex);
        }

        // 获取导出按钮
        const exportButton = document.getElementById('exportButton');
        let loadedExcelFileName = ''; // 用于存储加载的Excel文件名

        // 在加载Excel文件时，保存文件名
        excelFileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                loadedExcelFileName = file.name.split('.').slice(0, -1).join('.'); // 去掉扩展名
            }
        });

        // 导出按钮点击事件
        exportButton.addEventListener('click', function() {
            if (sceneData.length === 0) {
                alert('没有可导出的场景数据！');
                return;
            }

            // 创建工作表
            const worksheet = XLSX.utils.json_to_sheet(sceneData.map(scene => ({
                线路名称: scene.test,
                车型: scene.car,
                核查编号: scene.number,
                视频名称: scene.video,
                开始时间: scene.startTime,
                结束时间: scene.endTime,
                场景标签: scene.label,
                描述与原因: scene.remark,
                复查意见: scene.check
            })));
            // 设置单元格格式为数字
            ['C'].forEach(col => {
                for (let row = 2; row <= sceneData.length + 1; row++) {
                    const cell = worksheet[`${col}${row}`];
                    if (cell) {
                        cell.t = 'n'; // 设置单元格类型为数字
                    }
                }
            });
            // 设置开始时间和结束时间为时间格式
            ['E', 'F'].forEach(col => {
                for (let row = 2; row <= sceneData.length + 1; row++) {
                    const cell = worksheet[`${col}${row}`];
                    if (cell) {
                        cell.z = 'hh:mm:ss'; // 设置单元格格式为时间
                    }
                }
            });
            // 设置 F 和 K 列为文本格式
            ['A', 'B', 'D', 'G', 'H', 'I'].forEach(col => {
                for (let row = 2; row <= sceneData.length + 1; row++) {
                    const cell = worksheet[`${col}${row}`];
                    if (cell) {
                        cell.t = 's'; // 设置单元格类型为文本
                    }
                }
            });
            // 创建工作簿
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, '校验数据');

            // 设置导出的文件名
            const exportFileName = `${loadedExcelFileName || '场景数据'}_复查.xlsx`;

            // 导出文件
            XLSX.writeFile(workbook, exportFileName);
        });

        // 播放暂停
        document.getElementById('playButton').addEventListener('click', function () {
            if (videoPlayer.paused) {
                videoPlayer.play();
            }
            else {
                videoPlayer.pause();
            }
        });
        // 快进
        document.getElementById('fastForwardButton').addEventListener('click', function () {
            if (videoPlayer) {
                videoPlayer.currentTime += 1; // 快进1秒
            }
        });
         // 后退
        document.getElementById('rewindButton').addEventListener('click', function () {
            if (videoPlayer) {
                videoPlayer.currentTime -= 1; // 后退1秒
            }
        });

    </script>
</body>
</html>